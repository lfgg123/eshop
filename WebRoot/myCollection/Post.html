<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="Cache-Control" content="must-revalidate,no-cache"/>
	<meta name="viewport" content="width=device-width; initial-scale=1.0; minimum-scale=1.0; maximum-scale=1.0; user-scalable=no;"/>
	<title>919</title>
	<link href="../css/style.css" type="text/css" rel="stylesheet" />
	<link href="../css/swiper.css" type="text/css" rel="stylesheet" />
	<link href="../css/green.css" type="text/css" rel="stylesheet" />
	<link href="../css/mui.min.css" type="text/css" rel="stylesheet"/>
     <script type="text/javascript" src="../js/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src="../js/WeixinApi.js"></script>
	<script type="text/javascript" src="../js/path.js?a=222"></script>
	<script type="text/javascript" src="../js/mui.min.js"></script>
	<style>
    
    .swiper-container {
      width: 100%;
      height:8rem
    }
    .swiper-slide {
      text-align: center;
      font-size: 18px;
      background: #fff }
   
  </style>

</head>
<body>

<div class="header" id="header"><a class="headleft" href="javascript:void(0);" onclick="getback()"><img src="../images/fl_03.png" alt=""></a>内容详情 <a href="javascript:void(0);" class="fenxi"><img src="../images/fl_05.png" alt=""></a><a class="headright"><img src="../images/sp_03.png" alt=""></a></div>
<div class="jius" ><img src="" alt="" id="jius"> </div>
<div class="article" style="margin:0;border-top:1px solid #e6e6e6" id="article">

</div>

<!--
<div class="xguan">
	<div class="xgtj">相关推荐<a href="">更多></a></div>
	<div class="swiper-container">
	    <div class="swiper-wrapper xggd">
	      <div class="swiper-slide">
	      	<div class="slideon">
	      		<div class="slide_left"><img src="../images/fl_28.png" alt=""></div>
	      		<div style="font-size:1.2rem" class="slide_rihgt">
	      			<div>百年老讲台</div>
	      			<p>￥1000 <img src="../images/fl_24.png" alt=""></p>
	      		</div>
	      	</div>
	      </div>
	      <div class="swiper-slide">
	      	<div class="slideon">
	      		<div class="slide_left"><img src="../images/fl_28.png" alt=""></div>
	      		<div style="font-size:1.2rem" class="slide_rihgt">
	      			<div>百年老讲台</div>
	      			<p>￥1000 <img src="../images/fl_24.png" alt=""></p>
	      		</div>
	      	</div>
	      </div>
	      <div class="swiper-slide">
	      	<div class="slideon">
	      		<div class="slide_left"><img src="../images/fl_28.png" alt=""></div>
	      		<div style="font-size:1.2rem" class="slide_rihgt">
	      			<div>百年老讲台</div>
	      			<p>￥1000 <img src="../images/fl_24.png" alt=""></p>
	      		</div>
	      	</div>
	      </div>
	  
	    </div>
    
    	<div class="swiper-pagination"></div>
    </div>
</div>
-->

<div class="pinglun">
	<div class="plthree" id="plcount">评论：</div>
   <!--
	<div class="pingl" style="border-bottom:#e6e6e6 1px solid">
		<div class="txname">
			<div class="toux"><img src="../images/pj_12.png" alt=""></div>
			<div class="namex">
				酒神<br>
				赢得了豪华大礼，很开心
			</div>
			<div class="sjtime">2017-10-11</div>
		</div>
		<div class="huifu">
			<div>小雨：我也赢得了豪华大礼。</div>
			<div>小雪回复小雨：恭喜！恭喜！</div>
		</div>
	</div>
    
	<div class="pingl" style="border-bottom:#e6e6e6 1px solid">
		<div class="txname">
			<div class="toux"><img src="../images/pj_12.png" alt=""></div>
			<div class="namex">
				酒神<br>
				赢得了豪华大礼，很开心
			</div>
			<div class="sjtime">2017-10-11</div>
		</div>
		<div class="huifu">
			<div>小雨：我也赢得了豪华大礼。</div>
			<div>小雪回复小雨：恭喜！恭喜！</div>
		</div>
	</div>
    -->
</div>

<div class="fsong">
	<input type="text"  onFocus="gotopost()" placeholder="我也说一句" />
	<a href="javascript:void(0)" onclick="collect()"><img src="../images/hf_03.png" alt=""></a>
	<a href="tel:13764567708"><img src="../images/hf_05.png" alt=""></a>
	<a href="javascript:void(0)" onclick="dianz()" ><img src="../images/hf_08.png" alt=""></a>
</div>

<div style="height:4.5rem"></div>
<input type="hidden" id="member" val='abc' />
<input type="hidden" id="postId" val=0 />
<input type="hidden" id="userName" val="" />
<input type="hidden" id="userImage" val="" />
<input type="hidden"  id="token" value="XXyiewiowurwhfioe"/>

<script type="text/javascript" src="../js/swiper.js"></script>
<script type="text/javascript" src="../js/icheck.js"></script>

<script type="text/javascript">
    var swiper = new Swiper('.swiper-container', {
      slidesPerView: 1.5,
      spaceBetween: 10,
      freeMode: true,
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
    });
   var testdata1={
    "code": 1,
    "message": "操作成功",
    "result": {
        "id": 10,
        "state": 0,
        "content": "13年11月22日中午，喝了两杯13年4月的天之",
        "guid": "78a73d4f-836f-44bf-9ebc-3fcf9ffb06d4",
        "title": "略谈天之蓝给我的感受",
        "createTime": 1509295391000,
        "gnum": 0,
        "cnum": 0,
        "rnum": 0,
        "member": "abc",
        "imgs": "02.jpg;03.jpg;"
    }
};
mui.init();
   $(document).ready(function(){ 
		var curUrl=window.location.href;
		var member=curUrl.split('?')[1].split('&')[0].replace("member=","");
		var userName=curUrl.split('?')[1].split('&')[1].replace("userName=","");
		var userImage=curUrl.split('?')[1].split('&')[2].replace("userImage=","");
		var token=curUrl.split('?')[1].split('&')[3].replace("token=","");
		var postId=curUrl.split('?')[1].split('&')[4].replace("postId=","");
		$("#member").val(member);
		$("#postId").val(postId);
		$("#userName").val(decodeURI(userName));
		$("#userImage").val(userImage);
		$("#token").val(token);
		$("#jius").attr("src",pruImg+userImage);
		getPostById(postId);
	});

	function getPostById(postId){
		 var url=path+"app/member/getPostById";
		//后台请求
		$.ajax({
			url:url,
			type: "GET",
			data:{postId:postId},
			dataType: "JSON",
			cache: false,
			async: false,
			success: function (data) {
				if (data!=null&&data.code==1) {
					//刷新页面					
					var result=data.result;
					var strhtml = "";
					if(result!=null){
							var str="";
							var imgstr="";
							var imgslist=result.imgs.split(";");
							for(var k=0;k<imgslist.length;k++){
								if(imgslist[k]!=""){
                                       imgstr=imgstr+'<div><img src="'+pruImg+imgslist[k]+'" alt=""></div>'; 
									}	 
							}
							var createTime;
							if(result.createTime==null){
									createTime=dateFormat(Date.now());
							}else{
								createTime=dateFormat(result.createTime);
							}
						
							str='<h3>'+result.title+'</h3>\
										<div>'+createTime+'</div>'+imgstr+'\
										<p>'+result.content+'</p>';
							strhtml=strhtml+str;
							var replys=result.returns;
							//var plcount=replys.length;
							//头像	
				            //$("#jius").after(result.member);
							$("#jius").after(userName);
							$("#article").html(strhtml);
							$("#plcount").html("评论:"+plcount);
							showreply(replys);
						}
								
					}
						},
						error: function (XMLHttpRequest, textStatus, errorThrown) {
							//alert(XMLHttpRequest.status);
							//alert(XMLHttpRequest.readyState);
							//刷新页面					
						    mui.alert("加载文章失败");
						
						}
		   });
	}

	  function dateFormat(longTypeDate){  
		var dateType = "";  
		var date = new Date();  
		date.setTime(longTypeDate); 
		dateType = date.getFullYear()+"-"+getMonth(date)+"-"+getDay(date);//yyyy-MM-dd格式日期
		return dateType;
  } 
	//返回 01-12 的月份值   
	function getMonth(date){  
		var month = "";  
		month = date.getMonth() + 1; //getMonth()得到的月份是0-11  
		if(month<10){  
			month = "0" + month;  
		}  
		return month;  
	}  
	//返回01-30的日期  
	function getDay(date){  
		var day = "";  
		day = date.getDate();  
		if(day<10){  
			day = "0" + day;  
		}  
		return day;  
	}

	//收藏
	function collect(){
		var postId=$("#postId").val();
		var url=path+"app/member/collectPost";
		var TOKEN=$("#token").val();
		//后台请求
		$.ajax({
			url:url,
			type: "GET",
			dataType: "JSON",
			data:{TOKEN:TOKEN,postId:postId},
			cache: false,
			async: false,
			success: function (data) {
				if (data!=null&&data.code==1) {
			        //刷新收藏数量
					 mui.alert("收藏成功");
				}
			},
			error: function (XMLHttpRequest, textStatus, errorThrown) {
				//alert(XMLHttpRequest.status);
				//alert(XMLHttpRequest.readyState);
				//alert(textStatus);
				 //刷新收藏数量
				 mui.alert("收藏成功");
			}
		});
	}
    //点赞
	function dianz(){
		var postId=$("#postId").val();
		 var url=path+"app/member/upvotePost";
		//后台请求
		$.ajax({
			url:url,
			type: "GET",
			dataType: "JSON",
			data:{postId:postId},
			cache: false,
			async: false,
			success: function (data) {
				if (data!=null&&data.code==1) {
			        //刷新点赞数量
				    mui.alert("点赞成功");
				}
			},
			error: function (XMLHttpRequest, textStatus, errorThrown) {
				//alert(XMLHttpRequest.status);
				//alert(XMLHttpRequest.readyState);
				//alert(textStatus);
				//刷新点赞数量
				mui.alert("点赞成功");
			}
		});
	}
function showreply(reply){
	var strhtml="";
	var userImage=$("#userImage").val();
	if(reply!=null){
           $.each(reply, function (index, val) {
				var createTime=dateFormat(val.createTime);
				var str="";
				str='<div class="pingl" style="border-bottom:#e6e6e6 1px solid">\
						<div class="txname">\
							<div class="toux"><img src="'+val.img+'" alt=""></div>\
							<div class="namex" member="'+val.member+'">\
								'+val.nick+':<br>\
								'+val.content+'\
							</div>\
							<div class="sjtime">'+createTime+'</div>\
						</div>\
					</div>';
				strhtml=strhtml+str;	
			});
		}
		
		if($(".pingl")!=null&&$(".pingl")!=undefined){
            $(".pingl").remove();
		}
		
		if(reply!=null&&reply.length>0){
			$("#plcount").text("评论："+reply.length);
           $("#plcount").after(strhtml);
		}else{
		   $("#plcount").text("评论：0");
		}
}

function gotopost(){
	var member=$("#member").val();
	var postId=$("#postId").val();
	var userName=$("#userName").val();
	var userImage=$("#userImage").val();
	var token=$("#token").val();
	window.location.href="UserRemarkPosting.html?member="+member+"&userName="+encodeURI(userName)+"&userImage="+encodeURI(userImage)+"&token="+token+"&postId="+postId;
}   
function dateFormat(longTypeDate){  
	var dateType = "";  
	var date = new Date();  
	date.setTime(longTypeDate); 
	dateType = date.getFullYear()+"-"+getMonth(date)+"-"+getDay(date);//yyyy-MM-dd格式日期
	return dateType;
} 
//返回 01-12 的月份值   
function getMonth(date){  
	var month = "";  
	month = date.getMonth() + 1; //getMonth()得到的月份是0-11  
	if(month<10){  
		month = "0" + month;  
	}  
	return month;  
}  
//返回01-30的日期  
function getDay(date){  
	var day = "";  
	day = date.getDate();  
	if(day<10){  
		day = "0" + day;  
	}  
	return day;  
}

function getback(){
	var member=$("#member").val();
    var userName=$("#userName").val();
    var userImage=$("#userImage").val();
	var token=$("#token").val();
    window.location.href="collectionArticle.html?member="+member+"&userName="+encodeURI(userName)+"&userImage="+encodeURI(userImage)+"&token="+token;
}
</script>

</body>
</html>